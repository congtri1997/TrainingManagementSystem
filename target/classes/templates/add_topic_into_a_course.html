<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<!-- <head
	th:replace="fragments/general.html :: common_header(~{::title},~{::link})"> -->
<head
	th:replace="fragments/general.html :: common_header(~{::title},~{})">
	
	
<title>TMS - Add topic into a course</title>
</head>

<body>
	<!-- START PAGE CONTAINER -->
	<div class=" page-container">
		<th:block th:replace="fragments/general.html :: sidebar"></th:block>
		<!-- PAGE CONTENT -->
		<div class="page-content">
			<th:block
				th:replace="fragments/general.html :: navigation-horizontal"></th:block>
			<!-- PAGE CONTENT WRAPPER -->
			<div class="page-content-wrap">
				<div class="row">
					<div class="col-md-12">
						<form th:action="@{/staff/add_topic_into_a_course}" id="jss"
							class="form-horizontal" method="post" th:object="${topicForm}">
							<div class="panel panel-default">
								<div class="panel-heading">
									<h3 class="panel-title">
										<strong>Thêm topic vào một khóa học</strong>
									</h3>
									<ul class="panel-controls">
										<li><a href="#" class="panel-collapse"><span
												class="fa fa-angle-down"></span></a></li>
										<li><a href="#" class="panel-refresh"><span
												class="fas fa-sync"></span></a></li>
										<li><a href="#" class="panel-remove"><span
												class="fa fa-times"></span></a></li>
									</ul>
								</div>
								<div class="panel-body">
									<div class="row"  >
										<div class="col-md-6" style="max-height: 400px;
                                          overflow-y: auto;"> 
											<div class="form-group">
												<label class="col-md-3 col-xs-12 control-label">Tên topic</label>
												<div class="col-md-9 col-xs-12">
													<div class="input-group">
														<span class="input-group-addon"><span
															class="fa fa-pencil"></span></span> <input type="text"
															th:field="*{name}" class="form-control" />
													</div>
													<label id="name-error" class="form-text text-danger"
														for="name" th:if="${#fields.hasErrors('name')}"
														th:errors="*{name}">This field is required.</label> <label
														id="name-error" class="form-text text-danger"
														style="display: none"></label>
												</div>
											</div>
												<div class="form-group">
												<label class="col-md-3 col-xs-12 control-label">Ngày
													bắt đầu</label>
												<div class="col-md-9 col-xs-12">
													<div class="input-group date">
														<span class="input-group-addon"><span
															class="fas fa-calendar-day"></span></span> <input type="text"
															th:field="*{startDate}" id="dp" class="form-control" />
													</div>
													<label id="startDate-error" class="form-text text-danger"
														for="startDate" th:if="${#fields.hasErrors('startDate')}"
														th:errors="*{startDate}">This field is required.</label> <label
														id="startDate-error" class="form-text text-danger"
														style="display: none"></label>
												</div>
											</div>
											<div class="form-group">
												<label class="col-md-3 col-xs-12 control-label">Số tuần học</label>
												<div class="col-md-9 col-xs-12">
													<div class="input-group">
														<span class="input-group-addon"><span
															class="fa fa-pencil"></span></span> <input type="text"
															th:field="*{duration}" class="form-control" />
													</div>
													<label id="duration-error" class="form-text text-danger"
														for="duration" th:if="${#fields.hasErrors('duration')}"
														th:errors="*{duration}">This field is required.</label> <label
														id="duration-error" class="form-text text-danger"
														style="display: none"></label>
												</div>
											</div>
											<input type="hidden" id="courseID" name="course"/>

										
										</div>
										<div class="col-md-6" style="max-height: 400px; min-height: 200px;
                                          overflow-y: auto;">
                                          
                                          <label class="custom-select" for="styledSelect1"><!-- <select id="styledSelect1" name="options" style="font-size: 1.2rem">
                                                    <option value="">
                                                      Chọn khóa học
                                                  </option>
                                                  <option value="1">
                                                      Khóa học 1
                                                  </option>
                                                  <option value="2">
                                                      Khóa học 2
                                                  </option>
                                                  <option value="3">
                                                      Khóa học 3
                                                  </option>
                                                  <option value="4">
                                                      Khóa học 4
                                                  </option>
                                              </select> -->
                                              	<select id="selectbox1" class="form-control select">
														<option value="">Chọn khóa học</option>
														<option th:each="c : ${courses}"
															th:value="${c.id}" th:text="${c.name}"></option>
													</select>
                                              
                                              
                                              </label>
									<table id="courseTable" class="table"  style="display: none">
									<tr>
										<th>ID:</th>
										<td id="tableCourseID">Bill Gates</td>
									</tr>
									<tr>
										<th>Tên khóa học:</th>
										<td id="tableCourseName">555 77 854</td>
									</tr>
									<tr>
										<th>Ngày bắt đầu:</th>
										<td id="tableCourseStartDate">555 77 854</td>
									</tr>
									<tr>
										<th>Mô tả:</th>
										<td id="tableCourseDescription"></td>
									</tr>
							
									
								
					
								</table>
									


										</div>


									</div>




								</div>
								<div class="panel-footer">
									<button class="btn btn-default" type="reset">
										<i class="fal fa-redo"></i> Reset field
									</button>
									<button class="btn btn-default" type="button"
										onclick="location.href='/staff/trainee/list'">
										<i class="fal fa-arrow-left"></i> Quay lại
									</button>
									<button class="btn btn-primary pull-right" type="submit">
										<i class="fal fa-level-up"></i> Gửi
									</button>
								</div>


							</div>
						</form>
					</div>
				</div>
			</div>
			<!-- END PAGE CONTENT WRAPPER -->
		</div>
		<!-- END PAGE CONTENT -->
	</div>
	<!-- END PAGE CONTAINER -->
	<th:block th:replace="fragments/general.html :: logout"></th:block>

	<th:block
		th:replace="fragments/general.html :: common_plugins(~{::script})">
		<!-- START THIS PAGE PLUGINS-->
		<script type='text/javascript' src='js/plugins/icheck/icheck.min.js'
			th:src="@{/js/plugins/icheck/icheck.min.js}"></script>
		<script type='text/javascript'
			src='js/plugins/bootstrap/bootstrap-select.js'
			th:src="@{/js/plugins/bootstrap/bootstrap-select.js}"></script>
		<script type="text/javascript"
			src="js/plugins/mcustomscrollbar/jquery.mCustomScrollbar.min.js"
			th:src="@{/js/plugins/mcustomscrollbar/jquery.mCustomScrollbar.min.js}"></script>
		<script type='text/javascript'
			src='js/plugins/jquery-validation/jquery.validate.js'
			th:src="@{/js/plugins/jquery-validation/jquery.validate.js}"></script>
		<script type="text/javascript"
			src="js/plugins/bootstrap/bootstrap-datepicker.js"
			th:src="@{/js/plugins/bootstrap/bootstrap-datepicker.js}"></script>



		<script type="text/javascript"
			src="js/plugins/summernote/summernote.js"
			th:src="@{/js/plugins/summernote/summernote.js}"></script>
		<!-- END THIS PAGE PLUGINS -->

		<script type="text/javascript">
		
		function deleteData(id) {
			toastr
					.warning(
							"<div>Are you sure you want to delete this?</div>"
									+ "<div class='btn-group pull-right'>"
									+ "<button type='button' id='confirmationYes' class='btn btn-xs btn-default'><i class='fas fa-thumbs-up'></i> Yes</button>"
									+ "<button type='button' class='btn btn-xs btn-default clear'><i class='fas fa-trash-alt'></i> No</button>"
									+ "</div>",
							"Delete Confirmation",
							{
								allowHtml : true,
								closeButton : true,
								onShown : function() {
									$("#confirmationYes")
											.click(
													function() {
														$
																.ajax({
																	type : "DELETE",
																	url : "/staff/course/deleteTopic/"
																			+ id,
																	success : function(
																			data) {
																		if (data.validated) {
																			renderCourseInfomartion();
																			toastr
																					.success(
																							data.message,
																							"Delete Confirmation",
																							{
																								closeButton : true
																							});
																		} else {
																			toastr
																			.info(
																					data.message,
																					"Delete Confirmation",
																					{
																						closeButton : true
																					});
																		}
																	}
																});
													});
								}
							});
		}
		var renderCourseInfomartion = function() {
			var data = "";
		    $.ajax({
		        type:"GET",
		        url : "/staff/getCourse",
		        data : "courseID="+$('#selectbox1').val(),
		        async: true,
		        success : function(response) {
		            data = response;
		            /* console.log(data); */
		            
		            if(response) {
		           	$('#courseTable tbody').empty();
		            $('#courseTable tbody').append('<tr> <th> Mã khóa học </th> + <td>'  + response.id+  ' </td> </tr>') 
		            $('#courseTable tbody').append('<tr> <th> Tên khóa học </th> + <td>'  + response.name+  ' </td> </tr>') 
		            $('#courseTable tbody').append('<tr> <th> Ngày bắt đầu </th> + <td>'  + response.startDate+  ' </td> </tr>') 
		            $('#courseTable tbody').append('<tr> <th> Mô tả khóa học </th> + <td>'  + response.description+  ' </td> </tr>') 
		          /*   $('#tableCourseName').text(response.name)
		            $('#tableCourseStartDate').text(response.startDate)
		            $('#tableCourseDescription').html(response.description) */
		            $('#courseID').val(response.id);
		          /*   console.log(response.topics); */
		            response.topics.forEach(function(item) {
		            	$('#courseTable tbody').append('<tr> <th> Topic </th> <td>  ' + item.name +' - '+ item.startDate +' - ' + item.duration  +' <button type="button" class="btn btn-danger  btn-rounded btn-condensed btn-sm" onclick="deleteData('
							+ item.id
							+ ')"><i class="fal fa-trash-alt "></i></button> </td> </tr>')
		            });
		          /*   	$.each(response.topics, function(value) {
		            		console.log(value.name)
							$('#courseTable').append(value);
								

										}); */
		            $('#courseTable').show();
		            }
		            return response;
		        },
		        error: function() {
		            alert('Error occured');
		        }
		    });
		}
		$('#selectbox1').change(function() {
		    renderCourseInfomartion();
		
		 /*    var string = data.message.split(",");
		    var array = string.filter(function(e){return e;});
		    var select = $('selectbox2');
		    select.empty();
		    $.each(array, function(index, value) {          
		        select.append(
		                $('<option></option>').val(value).html(value)
		            );
		    });
		        $('#selectbox2').show(); */
		});
		
			toastr.options = {
				"closeButton" : true,
				"debug" : false,
				"newestOnTop" : false,
				"progressBar" : true,
				"positionClass" : "toast-top-right",
				"preventDuplicates" : true,
				"onclick" : null,
				"showDuration" : "300",
				"hideDuration" : "1000",
				"timeOut" : "5000",
				"extendedTimeOut" : "1000",
				"showEasing" : "swing",
				"hideEasing" : "linear",
				"showMethod" : "fadeIn",
				"hideMethod" : "fadeOut"
			}

			$.validator.addMethod("australianDate", function(value, element) {
				// put your own logic here, this is just a (crappy) example
				return value.match(/^\d\d?\/\d\d?\/\d\d\d\d$/);
			}, "Please enter a date in the format dd/mm/yyyy.");
			$.validator
					.setDefaults({
						highlight : function(element) {
							$(element).closest('.input-group').addClass(
									'has-error');

						},
						unhighlight : function(element) {
							$(element).closest('.input-group').removeClass(
									'has-error');
						},
						errorElement : 'label',
						errorClass : 'form-text text-danger',
						errorPlacement : function(error, element) {
							if (element.parent('.input-group').length) {
								error.insertAfter(element.parent());
							} else {
								error.insertAfter(element);
							}
						}
					});

			$("#jss").validate(
					{
						ignore : ".ignore *",
						submitHandler : function(form) {
							$("#description").val($("#description").code());
							$.ajax({
								type : $(form).attr('method'),
								url : $(form).attr('action'),
								data : $(form).serialize(),

								success : function(res) {

									if (res.validated) {
										renderCourseInfomartion();
										toastr["success"]("Tạo thành công!",
												"Thông báo")

									} else {
										//Set error messages
										toastr["error"]("Có lỗi xảy ra ???",
												"Thông báo")
										$.each(res.errorMessages, function(key,
												value) {

											$("#" + key + "-error").text("");
											/*  console.log('<span class="error">'+key +' - '+value+'</span>'); */
											$("#" + key + "-error").text(value)
													.show(); // div.foo elements that contain <p> tags

										});
									}

								}

							});
							return false;
						},
						rules : {
							

						},
						messages : {
							userName : {
								remote : 'Tên tài khoản đã được sử dụng'
							}

						},
						invalidHandler : function(form, validator) {
							toastr["error"]("Có lỗi xảy ra ???", "Thông báo")
						}
					});
			$.extend($.validator.messages, {
				required : "Hãy nhập.",
				remote : "Hãy sửa cho đúng.",
				email : "Hãy nhập email.",
				url : "Hãy nhập URL.",
				date : "Hãy nhập ngày.",
				dateISO : "Hãy nhập ngày (ISO).",
				number : "Hãy nhập số.",
				digits : "Hãy nhập chữ số.",
				creditcard : "Hãy nhập số thẻ tín dụng.",
				equalTo : "Hãy nhập thêm lần nữa.",
				extension : "Phần mở rộng không đúng.",
				maxlength : $.validator
						.format("Hãy nhập từ {0} kí tự trở xuống."),
				minlength : $.validator
						.format("Hãy nhập từ {0} kí tự trở lên."),
				rangelength : $.validator
						.format("Hãy nhập từ {0} đến {1} kí tự."),
				range : $.validator.format("Hãy nhập từ {0} đến {1}."),
				max : $.validator.format("Hãy nhập từ {0} trở xuống."),
				min : $.validator.format("Hãy nhập từ {0} trở lên.")
			});
			$('#dp').datepicker({
				startView : 2,
				format : 'dd/mm/yyyy'
			});
			
			
			</script>


	</th:block>

</body>

</html>